{"ast":null,"code":"var PDFJS = null;\nfunction render_page(pageData) {\n  //check documents https://mozilla.github.io/pdf.js/\n  //ret.text = ret.text ? ret.text : \"\";\n\n  let render_options = {\n    //replaces all occurrences of whitespace with standard spaces (0x20). The default value is `false`.\n    normalizeWhitespace: false,\n    //do not attempt to combine same line TextItem's. The default value is `false`.\n    disableCombineTextItems: false\n  };\n  return pageData.getTextContent(render_options).then(function (textContent) {\n    let lastY,\n      text = '';\n    //https://github.com/mozilla/pdf.js/issues/8963\n    //https://github.com/mozilla/pdf.js/issues/2140\n    //https://gist.github.com/hubgit/600ec0c224481e910d2a0f883a7b98e3\n    //https://gist.github.com/hubgit/600ec0c224481e910d2a0f883a7b98e3\n    for (let item of textContent.items) {\n      if (lastY == item.transform[5] || !lastY) {\n        text += item.str;\n      } else {\n        text += '\\n' + item.str;\n      }\n      lastY = item.transform[5];\n    }\n    //let strings = textContent.items.map(item => item.str);\n    //let text = strings.join(\"\\n\");\n    //text = text.replace(/[ ]+/ig,\" \");\n    //ret.text = `${ret.text} ${text} \\n\\n`;\n    return text;\n  });\n}\nconst DEFAULT_OPTIONS = {\n  pagerender: render_page,\n  max: 0,\n  //check https://mozilla.github.io/pdf.js/getting_started/\n  version: 'v1.10.100'\n};\nasync function PDF(dataBuffer, options) {\n  var isDebugMode = false;\n  let ret = {\n    numpages: 0,\n    numrender: 0,\n    info: null,\n    metadata: null,\n    text: \"\",\n    version: null\n  };\n  if (typeof options == 'undefined') options = DEFAULT_OPTIONS;\n  if (typeof options.pagerender != 'function') options.pagerender = DEFAULT_OPTIONS.pagerender;\n  if (typeof options.max != 'number') options.max = DEFAULT_OPTIONS.max;\n  if (typeof options.version != 'string') options.version = DEFAULT_OPTIONS.version;\n  if (options.version == 'default') options.version = DEFAULT_OPTIONS.version;\n  PDFJS = PDFJS ? PDFJS : require(`./pdf.js/${options.version}/build/pdf.js`);\n  ret.version = PDFJS.version;\n\n  // Disable workers to avoid yet another cross-origin issue (workers need\n  // the URL of the script to be loaded, and dynamically loading a cross-origin\n  // script does not work).\n  PDFJS.disableWorker = true;\n  let doc = await PDFJS.getDocument(dataBuffer);\n  ret.numpages = doc.numPages;\n  let metaData = await doc.getMetadata().catch(function (err) {\n    return null;\n  });\n  ret.info = metaData ? metaData.info : null;\n  ret.metadata = metaData ? metaData.metadata : null;\n  let counter = options.max <= 0 ? doc.numPages : options.max;\n  counter = counter > doc.numPages ? doc.numPages : counter;\n  ret.text = \"\";\n  for (var i = 1; i <= counter; i++) {\n    let pageText = await doc.getPage(i).then(pageData => options.pagerender(pageData)).catch(err => {\n      // todo log err using debug\n      debugger;\n      return \"\";\n    });\n    ret.text = `${ret.text}\\n\\n${pageText}`;\n  }\n  ret.numrender = counter;\n  doc.destroy();\n  return ret;\n}\nmodule.exports = PDF;","map":{"version":3,"names":["PDFJS","render_page","pageData","render_options","normalizeWhitespace","disableCombineTextItems","getTextContent","then","textContent","lastY","text","item","items","transform","str","DEFAULT_OPTIONS","pagerender","max","version","PDF","dataBuffer","options","isDebugMode","ret","numpages","numrender","info","metadata","require","disableWorker","doc","getDocument","numPages","metaData","getMetadata","catch","err","counter","i","pageText","getPage","destroy","module","exports"],"sources":["D:/LangChainJS/chatpdf/node_modules/pdf-parse/lib/pdf-parse.js"],"sourcesContent":["var PDFJS = null;\n\nfunction render_page(pageData) {\n    //check documents https://mozilla.github.io/pdf.js/\n    //ret.text = ret.text ? ret.text : \"\";\n\n    let render_options = {\n        //replaces all occurrences of whitespace with standard spaces (0x20). The default value is `false`.\n        normalizeWhitespace: false,\n        //do not attempt to combine same line TextItem's. The default value is `false`.\n        disableCombineTextItems: false\n    }\n\n    return pageData.getTextContent(render_options)\n        .then(function(textContent) {\n            let lastY, text = '';\n            //https://github.com/mozilla/pdf.js/issues/8963\n            //https://github.com/mozilla/pdf.js/issues/2140\n            //https://gist.github.com/hubgit/600ec0c224481e910d2a0f883a7b98e3\n            //https://gist.github.com/hubgit/600ec0c224481e910d2a0f883a7b98e3\n            for (let item of textContent.items) {\n                if (lastY == item.transform[5] || !lastY){\n                    text += item.str;\n                }  \n                else{\n                    text += '\\n' + item.str;\n                }    \n                lastY = item.transform[5];\n            }            \n            //let strings = textContent.items.map(item => item.str);\n            //let text = strings.join(\"\\n\");\n            //text = text.replace(/[ ]+/ig,\" \");\n            //ret.text = `${ret.text} ${text} \\n\\n`;\n            return text;\n        });\n}\n\nconst DEFAULT_OPTIONS = {\n    pagerender: render_page,\n    max: 0,\n    //check https://mozilla.github.io/pdf.js/getting_started/\n    version: 'v1.10.100'\n}\n\nasync function PDF(dataBuffer, options) {\n    var isDebugMode = false;\n\n    let ret = {\n        numpages: 0,\n        numrender: 0,\n        info: null,\n        metadata: null,\n        text: \"\",\n        version: null\n    };\n\n    if (typeof options == 'undefined') options = DEFAULT_OPTIONS;\n    if (typeof options.pagerender != 'function') options.pagerender = DEFAULT_OPTIONS.pagerender;\n    if (typeof options.max != 'number') options.max = DEFAULT_OPTIONS.max;\n    if (typeof options.version != 'string') options.version = DEFAULT_OPTIONS.version;\n    if (options.version == 'default') options.version = DEFAULT_OPTIONS.version;\n\n    PDFJS = PDFJS ? PDFJS : require(`./pdf.js/${options.version}/build/pdf.js`);\n\n    ret.version = PDFJS.version;\n\n    // Disable workers to avoid yet another cross-origin issue (workers need\n    // the URL of the script to be loaded, and dynamically loading a cross-origin\n    // script does not work).\n    PDFJS.disableWorker = true;\n    let doc = await PDFJS.getDocument(dataBuffer);\n    ret.numpages = doc.numPages;\n\n    let metaData = await doc.getMetadata().catch(function(err) {\n        return null;\n    });\n\n    ret.info = metaData ? metaData.info : null;\n    ret.metadata = metaData ? metaData.metadata : null;\n\n    let counter = options.max <= 0 ? doc.numPages : options.max;\n    counter = counter > doc.numPages ? doc.numPages : counter;\n\n    ret.text = \"\";\n\n    for (var i = 1; i <= counter; i++) {\n        let pageText = await doc.getPage(i).then(pageData => options.pagerender(pageData)).catch((err)=>{\n            // todo log err using debug\n            debugger;\n            return \"\";\n        });\n\n        ret.text = `${ret.text}\\n\\n${pageText}`;\n    }\n\n    ret.numrender = counter;\n    doc.destroy();\n\n    return ret;\n}\n\nmodule.exports = PDF;\n"],"mappings":"AAAA,IAAIA,KAAK,GAAG,IAAI;AAEhB,SAASC,WAAWA,CAACC,QAAQ,EAAE;EAC3B;EACA;;EAEA,IAAIC,cAAc,GAAG;IACjB;IACAC,mBAAmB,EAAE,KAAK;IAC1B;IACAC,uBAAuB,EAAE;EAC7B,CAAC;EAED,OAAOH,QAAQ,CAACI,cAAc,CAACH,cAAc,CAAC,CACzCI,IAAI,CAAC,UAASC,WAAW,EAAE;IACxB,IAAIC,KAAK;MAAEC,IAAI,GAAG,EAAE;IACpB;IACA;IACA;IACA;IACA,KAAK,IAAIC,IAAI,IAAIH,WAAW,CAACI,KAAK,EAAE;MAChC,IAAIH,KAAK,IAAIE,IAAI,CAACE,SAAS,CAAC,CAAC,CAAC,IAAI,CAACJ,KAAK,EAAC;QACrCC,IAAI,IAAIC,IAAI,CAACG,GAAG;MACpB,CAAC,MACG;QACAJ,IAAI,IAAI,IAAI,GAAGC,IAAI,CAACG,GAAG;MAC3B;MACAL,KAAK,GAAGE,IAAI,CAACE,SAAS,CAAC,CAAC,CAAC;IAC7B;IACA;IACA;IACA;IACA;IACA,OAAOH,IAAI;EACf,CAAC,CAAC;AACV;AAEA,MAAMK,eAAe,GAAG;EACpBC,UAAU,EAAEf,WAAW;EACvBgB,GAAG,EAAE,CAAC;EACN;EACAC,OAAO,EAAE;AACb,CAAC;AAED,eAAeC,GAAGA,CAACC,UAAU,EAAEC,OAAO,EAAE;EACpC,IAAIC,WAAW,GAAG,KAAK;EAEvB,IAAIC,GAAG,GAAG;IACNC,QAAQ,EAAE,CAAC;IACXC,SAAS,EAAE,CAAC;IACZC,IAAI,EAAE,IAAI;IACVC,QAAQ,EAAE,IAAI;IACdjB,IAAI,EAAE,EAAE;IACRQ,OAAO,EAAE;EACb,CAAC;EAED,IAAI,OAAOG,OAAO,IAAI,WAAW,EAAEA,OAAO,GAAGN,eAAe;EAC5D,IAAI,OAAOM,OAAO,CAACL,UAAU,IAAI,UAAU,EAAEK,OAAO,CAACL,UAAU,GAAGD,eAAe,CAACC,UAAU;EAC5F,IAAI,OAAOK,OAAO,CAACJ,GAAG,IAAI,QAAQ,EAAEI,OAAO,CAACJ,GAAG,GAAGF,eAAe,CAACE,GAAG;EACrE,IAAI,OAAOI,OAAO,CAACH,OAAO,IAAI,QAAQ,EAAEG,OAAO,CAACH,OAAO,GAAGH,eAAe,CAACG,OAAO;EACjF,IAAIG,OAAO,CAACH,OAAO,IAAI,SAAS,EAAEG,OAAO,CAACH,OAAO,GAAGH,eAAe,CAACG,OAAO;EAE3ElB,KAAK,GAAGA,KAAK,GAAGA,KAAK,GAAG4B,OAAO,CAAC,YAAYP,OAAO,CAACH,OAAO,eAAe,CAAC;EAE3EK,GAAG,CAACL,OAAO,GAAGlB,KAAK,CAACkB,OAAO;;EAE3B;EACA;EACA;EACAlB,KAAK,CAAC6B,aAAa,GAAG,IAAI;EAC1B,IAAIC,GAAG,GAAG,MAAM9B,KAAK,CAAC+B,WAAW,CAACX,UAAU,CAAC;EAC7CG,GAAG,CAACC,QAAQ,GAAGM,GAAG,CAACE,QAAQ;EAE3B,IAAIC,QAAQ,GAAG,MAAMH,GAAG,CAACI,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,UAASC,GAAG,EAAE;IACvD,OAAO,IAAI;EACf,CAAC,CAAC;EAEFb,GAAG,CAACG,IAAI,GAAGO,QAAQ,GAAGA,QAAQ,CAACP,IAAI,GAAG,IAAI;EAC1CH,GAAG,CAACI,QAAQ,GAAGM,QAAQ,GAAGA,QAAQ,CAACN,QAAQ,GAAG,IAAI;EAElD,IAAIU,OAAO,GAAGhB,OAAO,CAACJ,GAAG,IAAI,CAAC,GAAGa,GAAG,CAACE,QAAQ,GAAGX,OAAO,CAACJ,GAAG;EAC3DoB,OAAO,GAAGA,OAAO,GAAGP,GAAG,CAACE,QAAQ,GAAGF,GAAG,CAACE,QAAQ,GAAGK,OAAO;EAEzDd,GAAG,CAACb,IAAI,GAAG,EAAE;EAEb,KAAK,IAAI4B,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAID,OAAO,EAAEC,CAAC,EAAE,EAAE;IAC/B,IAAIC,QAAQ,GAAG,MAAMT,GAAG,CAACU,OAAO,CAACF,CAAC,CAAC,CAAC/B,IAAI,CAACL,QAAQ,IAAImB,OAAO,CAACL,UAAU,CAACd,QAAQ,CAAC,CAAC,CAACiC,KAAK,CAAEC,GAAG,IAAG;MAC5F;MACA;MACA,OAAO,EAAE;IACb,CAAC,CAAC;IAEFb,GAAG,CAACb,IAAI,GAAG,GAAGa,GAAG,CAACb,IAAI,OAAO6B,QAAQ,EAAE;EAC3C;EAEAhB,GAAG,CAACE,SAAS,GAAGY,OAAO;EACvBP,GAAG,CAACW,OAAO,CAAC,CAAC;EAEb,OAAOlB,GAAG;AACd;AAEAmB,MAAM,CAACC,OAAO,GAAGxB,GAAG","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}